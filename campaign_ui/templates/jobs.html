{% extends "base.html" %}

{% block title %}Jobs{% if campaign_name %} - {{ campaign_name }}{% endif %} - Campaign Management{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
        flex-wrap: wrap;
        gap: var(--spacing-md);
    }
    
    .page-header h1 {
        margin: 0;
    }
    
    .table-header-bar {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
        flex-wrap: wrap;
    }
    
    .search-input {
        flex: 1;
        min-width: 200px;
    }
    
    .header-controls {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
    }
    
    .status-dropdown {
        padding: 0.5rem;
        border: 2px solid var(--color-border-light);
        border-radius: var(--radius-md);
        font-size: var(--font-size-base);
        cursor: pointer;
        background-color: var(--color-surface);
    }
    
    .status-dropdown:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
    }
    
    .fit-badge-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        flex-wrap: wrap;
    }
    
    .fit-badge {
        display: inline-block;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
        font-size: var(--font-size-sm);
        font-weight: 600;
    }
    
    .fit-badge.perfect-fit {
        background-color: var(--color-success-bg);
        color: var(--color-success-text);
    }
    
    .fit-badge.good-fit {
        background-color: var(--color-info-bg);
        color: var(--color-info-text);
    }
    
    .fit-badge.moderate-fit {
        background-color: var(--color-warning-bg);
        color: var(--color-warning-text);
    }
    
    .note-icon {
        cursor: pointer;
        color: var(--color-primary);
        margin-left: var(--spacing-sm);
        font-size: var(--font-size-base);
    }
    
    .note-icon:hover {
        color: var(--color-primary-dark);
    }
    
    .note-preview {
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: var(--color-text-muted);
        font-size: var(--font-size-sm);
    }
    
    .table-job-title a {
        color: var(--color-text-primary);
        text-decoration: none;
        transition: color var(--transition-fast);
    }
    
    .table-job-title a:hover {
        color: var(--color-primary);
        text-decoration: underline;
    }
    
    .job-posting-link {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        color: var(--color-primary);
        text-decoration: none;
        margin-left: var(--spacing-xs);
    }
    
    .job-posting-link:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>Jobs{% if campaign_name %} - {{ campaign_name }}{% endif %}</h1>
    </div>
    <div>
        {% if campaign_id %}
            <a href="{{ url_for('view_campaign', campaign_id=campaign_id) }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Campaign
            </a>
        {% else %}
            <a href="{{ url_for('index') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Campaigns
            </a>
        {% endif %}
    </div>
</div>

<div class="table-header-bar">
    <input type="text" class="search-input" id="jobSearch" placeholder="Search jobs or companies...">
    <div class="header-controls">
        <select id="statusFilter">
            <option value="all">All Status</option>
            <option value="waiting">Waiting</option>
            <option value="applied">Applied</option>
            <option value="approved">Approved</option>
            <option value="interview">Interview</option>
            <option value="offer">Offer</option>
            <option value="rejected">Rejected</option>
            <option value="archived">Archived</option>
        </select>
        <button class="refresh-btn" onclick="window.location.reload()">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
    </div>
</div>

<div class="jobs-table-wrapper">
    {% if jobs %}
    <!-- Desktop Table View -->
    <table class="jobs-table">
        <thead>
            <tr>
                <th class="sortable" data-sort="company">Company Name</th>
                <th class="sortable" data-sort="status">Status</th>
                <th class="sortable" data-sort="date">Updated At</th>
                <th class="sortable" data-sort="title">Job Posting</th>
                <th class="sortable" data-sort="fit">Fit</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for job in jobs %}
            <tr>
                <td>
                    <div class="table-company-name">{{ job.company_name or 'Unknown' }}</div>
                </td>
                <td>
                    <form method="POST" action="{{ url_for('update_job_status', job_id=job.jsearch_job_id) }}" style="display: inline;" onchange="this.submit()">
                        <select name="status" class="status-dropdown">
                            <option value="waiting" {% if (job.job_status or 'waiting') == 'waiting' %}selected{% endif %}>Waiting</option>
                            <option value="applied" {% if job.job_status == 'applied' %}selected{% endif %}>Applied</option>
                            <option value="approved" {% if job.job_status == 'approved' %}selected{% endif %}>Approved</option>
                            <option value="interview" {% if job.job_status == 'interview' %}selected{% endif %}>Interview</option>
                            <option value="offer" {% if job.job_status == 'offer' %}selected{% endif %}>Offer</option>
                            <option value="rejected" {% if job.job_status == 'rejected' %}selected{% endif %}>Rejected</option>
                            <option value="archived" {% if job.job_status == 'archived' %}selected{% endif %}>Archived</option>
                        </select>
                    </form>
                </td>
                <td>
                    {% if job.ranked_at %}
                        {{ job.ranked_at.strftime('%Y-%m-%d %H:%M') if job.ranked_at.__class__.__name__ != 'str' else job.ranked_at }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <div class="table-job-title">
                        {{ job.job_title }}
                        {% if job.apply_options %}
                            {% set apply_options_parsed = job.apply_options | from_json %}
                            {% if apply_options_parsed %}
                                {% if apply_options_parsed is mapping %}
                                    {% set apply_link = apply_options_parsed.get('apply_link') %}
                                {% elif apply_options_parsed is iterable and apply_options_parsed[0] is mapping %}
                                    {% set apply_link = apply_options_parsed[0].get('apply_link') %}
                                {% endif %}
                                {% if apply_link %}
                                    <a href="{{ apply_link }}" target="_blank" class="job-posting-link" title="Open job posting">
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div class="fit-badge-wrapper">
                        {% set score = job.rank_score or 0 %}
                        {% set score_int = score | int %}
                        {% if score_int >= 80 %}
                            <span class="fit-badge perfect-fit">{{ score_int }} Perfect fit</span>
                        {% elif score_int >= 60 %}
                            <span class="fit-badge good-fit">{{ score_int }} Good fit</span>
                        {% else %}
                            <span class="fit-badge moderate-fit">{{ score_int }} Moderate fit</span>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div style="display: flex; align-items: center; justify-content: center; gap: var(--spacing-xs);">
                        {% if job.note_count and job.note_count > 0 %}
                            <span style="font-size: 0.875rem; color: var(--color-text-secondary);">{{ job.note_count }} note{{ 's' if job.note_count != 1 else '' }}</span>
                        {% endif %}
                        <button class="note-icon" onclick="openNoteModal('{{ job.jsearch_job_id }}', '{{ job.job_title|e }}')" title="{% if job.note_count and job.note_count > 0 %}View Notes{% else %}Add Note{% endif %}">
                            <i class="fas fa-sticky-note"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Mobile Card View -->
    <div class="cards-container">
        {% for job in jobs %}
        <div class="job-card">
            <div class="job-card-header">
                <h3 class="job-card-title">{{ job.job_title }}</h3>
                <div class="fit-badge-wrapper">
                    {% set score = job.rank_score or 0 %}
                    {% set score_int = score | int %}
                    {% if score_int >= 80 %}
                        <span class="fit-badge perfect-fit">{{ score_int }}</span>
                    {% elif score_int >= 60 %}
                        <span class="fit-badge good-fit">{{ score_int }}</span>
                    {% else %}
                        <span class="fit-badge moderate-fit">{{ score_int }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="job-card-meta">
                <div class="job-card-meta-item">
                    <span class="job-card-meta-label">Company:</span>
                    <span>{{ job.company_name or 'Unknown' }}</span>
                </div>
                <div class="job-card-meta-item">
                    <span class="job-card-meta-label">Status:</span>
                    <form method="POST" action="{{ url_for('update_job_status', job_id=job.jsearch_job_id) }}" style="display: inline;" onchange="this.submit()">
                        <select name="status" class="status-dropdown" style="width: auto; min-width: 120px;">
                            <option value="waiting" {% if (job.job_status or 'waiting') == 'waiting' %}selected{% endif %}>Waiting</option>
                            <option value="applied" {% if job.job_status == 'applied' %}selected{% endif %}>Applied</option>
                            <option value="approved" {% if job.job_status == 'approved' %}selected{% endif %}>Approved</option>
                            <option value="interview" {% if job.job_status == 'interview' %}selected{% endif %}>Interview</option>
                            <option value="offer" {% if job.job_status == 'offer' %}selected{% endif %}>Offer</option>
                            <option value="rejected" {% if job.job_status == 'rejected' %}selected{% endif %}>Rejected</option>
                            <option value="archived" {% if job.job_status == 'archived' %}selected{% endif %}>Archived</option>
                        </select>
                    </form>
                </div>
                <div class="job-card-meta-item">
                    <span class="job-card-meta-label">Updated:</span>
                    <span>
                        {% if job.ranked_at %}
                            {{ job.ranked_at.strftime('%Y-%m-%d %H:%M') if job.ranked_at.__class__.__name__ != 'str' else job.ranked_at }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                {% if job.apply_options %}
                    {% set apply_options_parsed = job.apply_options | from_json %}
                    {% if apply_options_parsed %}
                        {% if apply_options_parsed is mapping %}
                            {% set apply_link = apply_options_parsed.get('apply_link') %}
                        {% elif apply_options_parsed is iterable and apply_options_parsed[0] is mapping %}
                            {% set apply_link = apply_options_parsed[0].get('apply_link') %}
                        {% endif %}
                        {% if apply_link %}
                        <div class="job-card-meta-item">
                            <span class="job-card-meta-label">Apply:</span>
                            <a href="{{ apply_link }}" target="_blank" class="job-posting-link">
                                <i class="fas fa-external-link-alt"></i> View Posting
                            </a>
                        </div>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
            <div class="job-card-actions">
                <a href="{{ url_for('view_job_details', job_id=job.jsearch_job_id) }}" class="btn btn-primary btn-small">
                    <i class="fas fa-eye"></i> View Details
                </a>
                <button class="btn btn-secondary btn-small note-icon" onclick="openNoteModal('{{ job.jsearch_job_id }}', '{{ job.job_title|e }}')" title="{% if job.note_count and job.note_count > 0 %}View Notes{% else %}Add Note{% endif %}">
                    <i class="fas fa-sticky-note"></i> {% if job.note_count and job.note_count > 0 %}Notes ({{ job.note_count }}){% else %}Add Note{% endif %}
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="card">
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-briefcase"></i>
            </div>
            <h2 class="empty-state-title">No Jobs Found</h2>
            <p class="empty-state-message">
                {% if campaign_id %}
                    No jobs have been found for this campaign yet. Try running "Find Jobs" to search for matching positions.
                {% else %}
                    No jobs match your current filters. Try adjusting your search criteria or filters.
                {% endif %}
            </p>
            {% if campaign_id %}
            <a href="{{ url_for('view_campaign', campaign_id=campaign_id) }}" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Back to Campaign
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Note Modal -->
<div class="modal-overlay" id="noteModal">
    <div class="modal" style="max-width: 600px;">
        <div class="modal-header">
            <h3>Notes for <span id="modalJobTitle"></span></h3>
            <button class="modal-close" onclick="closeNoteModal()" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
            <!-- Add New Note Section -->
            <div class="form-group" style="margin-bottom: var(--spacing-lg);">
                <label for="note_text">Add New Note:</label>
                <textarea id="note_text" name="note_text" rows="4" placeholder="Enter your note here..."></textarea>
                <div class="form-actions" style="margin-top: var(--spacing-sm);">
                    <button type="button" class="btn btn-primary" onclick="addNewNote()">Add Note</button>
                </div>
            </div>

            <hr style="margin: var(--spacing-lg) 0;">

            <!-- Existing Notes Section -->
            <div id="notesListContainer">
                <div id="notesList" style="max-height: 400px; overflow-y: auto;">
                    <div class="notes-loading" style="text-align: center; padding: var(--spacing-md);">
                        <i class="fas fa-spinner fa-spin"></i> Loading notes...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentJobId = null;

function openNoteModal(jobId, jobTitle) {
    currentJobId = jobId;
    document.getElementById('modalJobTitle').textContent = jobTitle;
    document.getElementById('note_text').value = '';
    document.getElementById('noteModal').classList.add('active');
    loadNotes(jobId);
}

function closeNoteModal() {
    document.getElementById('noteModal').classList.remove('active');
    currentJobId = null;
    document.getElementById('note_text').value = '';
    document.getElementById('notesList').innerHTML = '';
}

function loadNotes(jobId) {
    const notesList = document.getElementById('notesList');
    notesList.innerHTML = '<div class="notes-loading" style="text-align: center; padding: var(--spacing-md);"><i class="fas fa-spinner fa-spin"></i> Loading notes...</div>';

    fetch(`/jobs/${encodeURIComponent(jobId)}/note`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                notesList.innerHTML = `<div class="error-message" style="color: var(--color-error); padding: var(--spacing-md);">Error: ${data.error}</div>`;
                return;
            }

            const notes = data.notes || [];
            if (notes.length === 0) {
                notesList.innerHTML = '<div class="empty-state" style="text-align: center; padding: var(--spacing-lg); color: var(--color-text-secondary);">No notes yet. Add your first note above!</div>';
                return;
            }

            // Store original note texts for cancel functionality
            window.noteOriginalTexts = window.noteOriginalTexts || {};
            
            notesList.innerHTML = notes.map(note => {
                const createdDate = new Date(note.created_at).toLocaleString();
                const updatedDate = new Date(note.updated_at).toLocaleString();
                const isModified = note.is_modified;
                const noteId = note.note_id;
                const noteText = escapeHtml(note.note_text);
                
                // Store original text for cancel edit functionality
                window.noteOriginalTexts[noteId] = note.note_text;

                return `
                    <div class="note-item" data-note-id="${noteId}" style="border: 1px solid var(--color-border); border-radius: var(--border-radius); padding: var(--spacing-md); margin-bottom: var(--spacing-md); background: var(--color-background-secondary);">
                        <div class="note-header" style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--spacing-sm);">
                            <div class="note-meta" style="flex: 1;">
                                <div style="font-size: 0.875rem; color: var(--color-text-secondary);">
                                    Created: ${createdDate}
                                    ${isModified ? `<span class="edited-badge" style="margin-left: var(--spacing-sm); padding: 2px 6px; background: var(--color-warning); color: white; border-radius: 3px; font-size: 0.75rem;"><i class="fas fa-edit"></i> Edited</span>` : ''}
                                </div>
                                ${isModified ? `<div style="font-size: 0.875rem; color: var(--color-text-secondary); margin-top: 2px;">Last modified: ${updatedDate}</div>` : ''}
                            </div>
                            <div class="note-actions" style="display: flex; gap: var(--spacing-xs);">
                                <button class="btn btn-small btn-secondary" onclick="editNote(${noteId})" title="Edit note">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-small btn-danger" onclick="deleteNote(${noteId})" title="Delete note">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="note-content" id="note-content-${noteId}" style="white-space: pre-wrap; word-wrap: break-word;">${noteText}</div>
                        <div class="note-edit-form" id="note-edit-${noteId}" style="display: none; margin-top: var(--spacing-sm);">
                            <textarea id="note-edit-text-${noteId}" rows="3" style="width: 100%; padding: var(--spacing-sm); border: 1px solid var(--color-border); border-radius: var(--border-radius);">${escapeHtml(note.note_text)}</textarea>
                            <div style="display: flex; gap: var(--spacing-xs); margin-top: var(--spacing-sm);">
                                <button class="btn btn-small btn-primary" onclick="saveNoteEdit(${noteId})">Save</button>
                                <button class="btn btn-small btn-secondary" onclick="cancelNoteEdit(${noteId})">Cancel</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        })
        .catch(error => {
            console.error('Error loading notes:', error);
            notesList.innerHTML = `<div class="error-message" style="color: var(--color-error); padding: var(--spacing-md);">Error loading notes. Please try again.</div>`;
        });
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showNoteMessage(message, type = 'info') {
    // Remove any existing message
    const existingMsg = document.getElementById('note-message');
    if (existingMsg) {
        existingMsg.remove();
    }
    
    // Create message element
    const messageDiv = document.createElement('div');
    messageDiv.id = 'note-message';
    messageDiv.style.cssText = `
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-md);
        border-radius: var(--border-radius);
        ${type === 'error' ? 'background: #fee; color: #c33; border: 1px solid #fcc;' : ''}
        ${type === 'success' ? 'background: #efe; color: #3c3; border: 1px solid #cfc;' : ''}
        ${type === 'info' ? 'background: #eef; color: #33c; border: 1px solid #ccf;' : ''}
    `;
    messageDiv.textContent = message;
    
    // Insert at top of modal content
    const modalContent = document.querySelector('.modal-content');
    if (modalContent) {
        modalContent.insertBefore(messageDiv, modalContent.firstChild);
        
        // Auto-remove after 5 seconds for success/info messages
        if (type !== 'error') {
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }
    }
}

function addNewNote() {
    const noteText = document.getElementById('note_text').value.trim();
    if (!noteText) {
        showNoteMessage('Please enter a note', 'error');
        return;
    }

    const button = document.querySelector('button[onclick*="addNewNote"]');
    const originalText = button?.textContent || 'Add Note';
    if (button) {
        button.disabled = true;
        button.textContent = 'Adding...';
    }

    const formData = new FormData();
    formData.append('note_text', noteText);

    fetch(`/jobs/${encodeURIComponent(currentJobId)}/note`, {
        method: 'POST',
        body: formData
    })
        .then(response => {
            if (!response.ok) {
                return response.json().then(data => Promise.reject(data));
            }
            return response.json();
        })
        .then(data => {
            document.getElementById('note_text').value = '';
            loadNotes(currentJobId);
            showNoteMessage('Note added successfully!', 'success');
        })
        .catch(error => {
            console.error('Error adding note:', error);
            const errorMsg = error?.error || error?.message || 'Error adding note. Please try again.';
            showNoteMessage(errorMsg, 'error');
        })
        .finally(() => {
            if (button) {
                button.disabled = false;
                button.textContent = originalText;
            }
        });
}

function editNote(noteId) {
    document.getElementById(`note-content-${noteId}`).style.display = 'none';
    document.getElementById(`note-edit-${noteId}`).style.display = 'block';
}

function cancelNoteEdit(noteId) {
    document.getElementById(`note-content-${noteId}`).style.display = 'block';
    document.getElementById(`note-edit-${noteId}`).style.display = 'none';
    // Reset textarea to original value from stored data
    if (window.noteOriginalTexts && window.noteOriginalTexts[noteId]) {
        document.getElementById(`note-edit-text-${noteId}`).value = window.noteOriginalTexts[noteId];
    }
}

function saveNoteEdit(noteId) {
    const noteText = document.getElementById(`note-edit-text-${noteId}`).value.trim();
    if (!noteText) {
        showNoteMessage('Note text cannot be empty', 'error');
        return;
    }

    const button = document.querySelector(`button[onclick*="saveNoteEdit(${noteId})"]`);
    const originalText = button?.textContent || 'Save';
    if (button) {
        button.disabled = true;
        button.textContent = 'Saving...';
    }

    fetch(`/jobs/${encodeURIComponent(currentJobId)}/note/${noteId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ note_text: noteText })
    })
        .then(response => {
            if (!response.ok) {
                return response.json().then(data => Promise.reject(data));
            }
            return response.json();
        })
        .then(data => {
            loadNotes(currentJobId);
            showNoteMessage('Note updated successfully!', 'success');
        })
        .catch(error => {
            console.error('Error updating note:', error);
            const errorMsg = error?.error || error?.message || 'Error updating note. Please try again.';
            showNoteMessage(errorMsg, 'error');
        })
        .finally(() => {
            if (button) {
                button.disabled = false;
                button.textContent = originalText;
            }
        });
}

function deleteNote(noteId) {
    if (!confirm('Are you sure you want to delete this note?')) {
        return;
    }

    const button = document.querySelector(`button[onclick*="deleteNote(${noteId})"]`);
    const originalHTML = button ? button.innerHTML : '<i class="fas fa-trash"></i>';
    if (button) {
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    }

    fetch(`/jobs/${encodeURIComponent(currentJobId)}/note/${noteId}`, {
        method: 'DELETE'
    })
        .then(response => {
            if (!response.ok) {
                return response.json().then(data => Promise.reject(data));
            }
            return response.json();
        })
        .then(data => {
            loadNotes(currentJobId);
            showNoteMessage('Note deleted successfully!', 'success');
        })
        .catch(error => {
            console.error('Error deleting note:', error);
            const errorMsg = error?.error || error?.message || 'Error deleting note. Please try again.';
            showNoteMessage(errorMsg, 'error');
            if (button) {
                button.disabled = false;
                button.innerHTML = originalHTML;
            }
        });
}

// Close modal when clicking outside
document.getElementById('noteModal')?.addEventListener('click', function(event) {
    if (event.target === this) {
        closeNoteModal();
    }
});

// Search functionality
document.getElementById('jobSearch')?.addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.jobs-table tbody tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
});

// Status filter functionality
document.getElementById('statusFilter')?.addEventListener('change', function(e) {
    const filterValue = e.target.value;
    const rows = document.querySelectorAll('.jobs-table tbody tr');
    
    rows.forEach(row => {
        if (filterValue === 'all') {
            row.style.display = '';
        } else {
            const statusSelect = row.querySelector('.status-dropdown');
            const currentStatus = statusSelect ? statusSelect.value : '';
            row.style.display = currentStatus === filterValue ? '' : 'none';
        }
    });
});
</script>
{% endblock %}
