{% extends "base.html" %}

{% block title %}Documents - Campaign Management{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Documents</h1>
    <p class="page-subtitle">Manage your resumes and cover letters</p>
</div>

<div class="documents-container">
    <!-- Resumes Section -->
    <div class="section-card">
        <div class="section-header">
            <h2>
                <i class="fas fa-file-pdf"></i>
                Resumes
            </h2>
            <button class="btn btn-primary" onclick="showResumeUploadModal()">
                <i class="fas fa-plus"></i> Upload Resume
            </button>
        </div>
        
        {% if resumes %}
        <div class="documents-list">
            {% for resume in resumes %}
            <div class="document-item">
                <div class="document-info">
                    <div class="document-icon">
                        {% if resume.file_type == 'application/pdf' %}
                        <i class="fas fa-file-pdf"></i>
                        {% elif 'wordprocessingml' in resume.file_type %}
                        <i class="fas fa-file-word"></i>
                        {% else %}
                        <i class="fas fa-file"></i>
                        {% endif %}
                    </div>
                    <div class="document-details">
                        <span class="document-name">{{ resume.resume_name }}</span>
                        <span class="document-meta">
                            {% if resume.file_size %}
                            {{ (resume.file_size / 1024) | round(1) }} KB
                            {% endif %}
                            • {{ resume.created_at.strftime('%Y-%m-%d') if resume.created_at else 'Unknown date' }}
                        </span>
                    </div>
                </div>
                <div class="document-actions">
                    <a href="{{ url_for('download_resume_documents', resume_id=resume.resume_id) }}" 
                       class="btn btn-sm btn-secondary" 
                       title="Download">
                        <i class="fas fa-download"></i>
                    </a>
                    <button class="btn btn-sm btn-danger" 
                            onclick="confirmDeleteResume({{ resume.resume_id }}, '{{ resume.resume_name }}')"
                            title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-file-pdf"></i>
            </div>
            <h2 class="empty-state-title">No Resumes Yet</h2>
            <p class="empty-state-message">Upload your resume to attach it to job applications. You can upload multiple versions for different types of positions.</p>
            <button class="btn btn-primary" onclick="showResumeUploadModal()">
                <i class="fas fa-plus"></i> Upload Your First Resume
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Cover Letters Section -->
    <div class="section-card">
        <div class="section-header">
            <h2>
                <i class="fas fa-file-alt"></i>
                Cover Letters
            </h2>
            <button class="btn btn-primary" onclick="showCoverLetterModal()">
                <i class="fas fa-plus"></i> Create Cover Letter
            </button>
        </div>
        
        {% if cover_letters %}
        <div class="documents-list">
            {% for cover_letter in cover_letters %}
            <div class="document-item">
                <div class="document-info">
                    <div class="document-icon">
                        {% if cover_letter.file_path %}
                        {% if 'pdf' in cover_letter.file_path %}
                        <i class="fas fa-file-pdf"></i>
                        {% elif 'docx' in cover_letter.file_path %}
                        <i class="fas fa-file-word"></i>
                        {% else %}
                        <i class="fas fa-file"></i>
                        {% endif %}
                        {% else %}
                        <i class="fas fa-file-alt"></i>
                        {% endif %}
                    </div>
                    <div class="document-details">
                        <span class="document-name">{{ cover_letter.cover_letter_name }}</span>
                        <span class="document-meta">
                            {% if cover_letter.file_path %}
                            File
                            {% else %}
                            Text
                            {% endif %}
                            • {{ cover_letter.created_at.strftime('%Y-%m-%d') if cover_letter.created_at else 'Unknown date' }}
                        </span>
                    </div>
                </div>
                <div class="document-actions">
                    {% if cover_letter.file_path %}
                    <a href="{{ url_for('download_cover_letter_documents', cover_letter_id=cover_letter.cover_letter_id) }}" 
                       class="btn btn-sm btn-secondary" 
                       title="Download">
                        <i class="fas fa-download"></i>
                    </a>
                    {% else %}
                    <button class="btn btn-sm btn-secondary" 
                            onclick="viewCoverLetterText({{ cover_letter.cover_letter_id }})"
                            title="View">
                        <i class="fas fa-eye"></i>
                    </button>
                    {% endif %}
                    <button class="btn btn-sm btn-danger" 
                            onclick="confirmDeleteCoverLetter({{ cover_letter.cover_letter_id }}, '{{ cover_letter.cover_letter_name }}')"
                            title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <h2 class="empty-state-title">No Cover Letters Yet</h2>
            <p class="empty-state-message">Create cover letters to personalize your job applications. You can write them manually or generate them using AI for specific job postings.</p>
            <button class="btn btn-primary" onclick="showCoverLetterModal()">
                <i class="fas fa-plus"></i> Create Your First Cover Letter
            </button>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- Resume Upload Modal -->
<div id="resumeUploadModal" class="modal-overlay" style="display: none !important;">
    <div class="modal">
        <div class="modal-header">
            <h3>Add Resume</h3>
            <button class="modal-close" onclick="closeResumeUploadModal()" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
        <!-- Upload New Tab -->
        <div id="resumeUploadTab" class="modal-tab-content">
            <form method="POST" action="{{ url_for('upload_resume_documents') }}" 
                  enctype="multipart/form-data" 
                  id="resumeUploadForm"
                  onsubmit="return uploadResume(event);">
                <div class="form-group">
                    <label for="resume_name">Resume Name:</label>
                    <input type="text" name="resume_name" id="resume_name" class="form-control" 
                           placeholder="e.g., Data Engineer Resume v2">
                </div>
                <div class="form-group">
                    <label for="resume_file">Select File (PDF or DOCX, max 5MB):</label>
                    <input type="file" name="file" id="resume_file" accept=".pdf,.docx" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Upload</button>
                    <button type="button" class="btn btn-secondary" onclick="closeResumeUploadModal()">Cancel</button>
                </div>
            </form>
        </div>
        </div>
    </div>
</div>

<!-- Cover Letter Modal -->
<div id="coverLetterModal" class="modal-overlay" style="display: none !important;">
    <div class="modal">
        <div class="modal-header">
            <h3>Add Cover Letter</h3>
            <button class="modal-close" onclick="closeCoverLetterModal()" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
        <!-- Create New Tab -->
        <div id="coverLetterCreateTab" class="modal-tab-content">
            <form method="POST" action="{{ url_for('create_cover_letter_documents') }}" 
                  enctype="multipart/form-data" 
                  id="coverLetterForm"
                  onsubmit="return createCoverLetter(event);">
                <div class="form-group">
                    <label for="cover_letter_name">Cover Letter Name:</label>
                    <input type="text" name="cover_letter_name" id="cover_letter_name" class="form-control" 
                           placeholder="e.g., Generic Cover Letter" required>
                </div>
                <div class="form-group">
                    <label>Create as:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="cover_letter_type" value="text" checked onchange="toggleCoverLetterType()"> Text</label>
                        <label><input type="radio" name="cover_letter_type" value="file" onchange="toggleCoverLetterType()"> File Upload</label>
                    </div>
                </div>
                <div class="form-group" id="coverLetterTextGroup">
                    <label for="cover_letter_text">Cover Letter Text:</label>
                    <textarea name="cover_letter_text" id="cover_letter_text" class="form-control" rows="10" 
                              placeholder="Dear Hiring Manager,&#10;&#10;I am writing to express my interest..."></textarea>
                </div>
                <div class="form-group" id="coverLetterFileGroup" style="display: none;">
                    <label for="cover_letter_file">Select File (PDF or DOCX, max 5MB):</label>
                    <input type="file" name="file" id="cover_letter_file" accept=".pdf,.docx">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Create</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCoverLetterModal()">Cancel</button>
                </div>
            </form>
        </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteConfirmModal" class="modal-overlay" style="display: none !important;">
    <div class="modal">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button class="modal-close" onclick="closeDeleteConfirmModal()" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
        <p id="deleteConfirmMessage">Are you sure you want to delete this document?</p>
        <div class="form-actions">
            <form id="deleteForm" method="POST" style="display: inline;">
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
            <button type="button" class="btn btn-secondary" onclick="closeDeleteConfirmModal()">Cancel</button>
        </div>
        </div>
    </div>
</div>

<!-- Cover Letter Text View Modal -->
<div id="coverLetterTextViewModal" class="modal-overlay" style="display: none !important;">
    <div class="modal">
        <div class="modal-header">
            <h3 id="coverLetterTextViewTitle">Cover Letter</h3>
            <button class="modal-close" onclick="closeCoverLetterTextViewModal()" aria-label="Close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
        <div class="cover-letter-text-view" id="coverLetterTextViewContent">
            <!-- Content will be loaded via JavaScript -->
        </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/documents.js') }}"></script>
{% endblock %}

